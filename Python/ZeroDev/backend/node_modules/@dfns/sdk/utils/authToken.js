"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.assertAuthTokenIsSameOrg = exports.JWT_CUSTOM_DATA_CLAIM = void 0;
const base64_1 = require("./base64");
exports.JWT_CUSTOM_DATA_CLAIM = 'https://custom/app_metadata';
const assertAuthTokenIsSameOrg = ({ authToken, orgId }) => {
    const tokenBody = authToken.split('.')?.[1] || '';
    let decoded;
    try {
        decoded = JSON.parse((0, base64_1.fromBase64)(tokenBody).toString('utf-8'));
    }
    catch (error) {
        throw new Error('Provided auth token could not be properly parsed');
    }
    const tokenOrgId = decoded?.[exports.JWT_CUSTOM_DATA_CLAIM]?.['orgId'];
    if (tokenOrgId !== orgId) {
        throw new Error(`Provided auth token is not scoped to org ID ${orgId}`);
    }
};
exports.assertAuthTokenIsSameOrg = assertAuthTokenIsSameOrg;
